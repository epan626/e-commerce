<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    {% load staticfiles %}
    <link type="text/css" rel='stylesheet' href="{% static 'ecommerce/css/materialize.css'%}">
    <style type="text/css">
      .input-field input:focus + label {
        color: red !important;
      }
      .input-field input:focus {
        border-bottom: 1px solid red !important;
        box-shadow: 0 1px 0 0 red !important;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-wrapper red">
        <a href="#" class="brand-logo">&nbsp;&nbsp;Dashboard</a>
        <div class="row">
          <div class="col s4 offset-s2">
            <ul id="nav-mobile" class="hide-on-med-and-down">
              <li><a href="{% url 'orders' %}">Orders</a></li>
              <li><a href="{% url 'product'%}">Products</a></li>
            </ul>
          </div>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="">Sign Out</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="row">
      <div class="col s2">
        <form>
          <div class="input-field">
            <input id="search" type="search" required>
            <label for="search">Search</label>
          </div>
        </form>
        <div class="testing">
            <form action="testcreate" method="POST">
                {% csrf_token %}
                <input type="submit" value="Create">
            </form>
        </div>
      </div>
      <div class="col s2 offset-s8 input-field">
        <select name="status">
          <option value="#function query#">Show All</option>
          <option value="Order in process">Order in process</option>
          <option value="Shipped">Shipped</option>
           <option value="Cancelled">Cancelled</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col s10 offset-s1">
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Name</th>
              <th>Date</th>
              <th>Billing Address</th>
              <th>Total</th>
              <th>Status</th>
            </tr>
          </thead>
          {% for bill in billings %}
          <tr>
            <td><a href="{% url 'show' id=bill.order.id %}">{{bill.order.id}}</a></td>
            <td>{{bill.first_name}}</td>
            <td>{{bill.order.added_at}}</td>
            <td>{{bill.address}} {{bill.city}} {{bill.state}} {{bill.zipcode}}</td>
            <td>{{bill.order.total}}</td>
            <td>
                <select name="status">
                   <option  selected='selected' value="{{bill.order.status}}">{{bill.order.status}}</option>
                   <option value="Order in process">Order in process</option>
                   <option value="Shipped">Shipped</option>
                   <option value="Cancelled">Cancelled</option>
                </select>
                <input class = 'upstatus' type="hidden" value="{{bill.order.id}}"></td>
          </tr>
          {%  endfor %}
        </table>
      </div>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="{% static 'ecommerce/js/materialize.js'%}"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      $('select').material_select();

      $( "select" )
        .change(function () {
          $( "select option:selected" )
              var orderid = $(this).parents().siblings('input').val()
              var status = $(this).val()
              console.log(status)
              console.log(orderid)
              $.ajax({
                  type: 'GET',
                  url: '{% url 'update' %}',
                  data: {'status':status, 'orderid':orderid}
              });
          })
    });
    </script>
  </body>
</html>
